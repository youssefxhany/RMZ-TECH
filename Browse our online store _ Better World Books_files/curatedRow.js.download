define(['text!templates/curatedRow.html'],function(template){Vue.component('curatedrow',{template:template,props:['name','description','app-id','api-key','index-name','isbns','show-new-price'],data:function(){return{hits:[],localize:bwb.localize.siteSettings,client:null,index:null,isbnArray:[],defaultHitCount:6,page:0,lastPage:0,transitionInNext:"animated fadeInRightBig",transitionOutNext:"animated fadeOutLeftBig",transitionInPrev:"animated fadeInLeftBig",transitionOutPrev:"animated fadeOutRightBig",transitionInNextMobile:"animated fadeInRight",transitionOutNextMobile:"animated fadeOutLeft",transitionInPrevMobile:"animated fadeInLeft",transitionOutPrevMobile:"animated fadeOutRight",mobileTransitionWidth:1440,twoItemMaxWidth:768,fourItemMaxWidth:992,autoRotateTimer:0,autoRotateTimeout:null,};},computed:{rowId:function(){return bwb.helpers.dashify(this.name);},hideMe:function(){return!this.isbns;},finalPage:function(){return Math.ceil(this.isbnArray.length/this.defaultHitCount)-1},finalPageItems:function(){var leftovers=this.isbnArray.length%this.defaultHitCount
if(leftovers==0){return this.defaultHitCount;}else{return leftovers;}}},methods:{getItems:function(){if(!this.isbnArray)
return;this.hits=[]
var pageStart=this.page*this.defaultHitCount
var pageEnd=this.defaultHitCount+pageStart
if(this.page==this.finalPage){pageEnd=pageStart+this.finalPageItems}
for(var x=pageStart;x<pageEnd;x++){this.getHit(this.isbnArray[x]);}},getHit:function(isbn){var self=this;self.client=algoliasearch(self.appId,self.apiKey);self.index=self.client.initIndex(self.indexName);self.index.search({query:'\"'+isbn+'\"'}).then(function(result){if(result&&result.hits.length){self.hits.push(result.hits[0]);}});},setPage:function(newPage,disableRotate){if(disableRotate){this.disableAutoRotate();}
this.lastPage=this.page;this.page=newPage;this.getItems();},disableAutoRotate:function(){this.autoRotateTimer=0;clearTimeout(this.autoRotateTimeout);},getTransitionIn:function(){var windowWidth=$(window).width();if(this.lastPage<this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionInNext:this.transitionInNextMobile;}else if(this.lastPage>this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionInPrev:this.transitionInPrevMobile;}else{return "";}},getTransitionOut:function(){var windowWidth=$(window).width();if(this.lastPage<this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionOutNext:this.transitionOutNextMobile;}else if(this.lastPage>this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionOutPrev:this.transitionOutPrevMobile;}else{return "";}},setupGestures:function(){var self=this;var mc=new Hammer(document.getElementById(self.rowId));mc.on("panstart",function(e){if(e.additionalEvent=="panleft"&&self.page<self.finalPage)
self.setPage(self.page+1,true);else if(e.additionalEvent=="panright"&&self.page>=1)
self.setPage(self.page-1,true);});},determineScrollWidth:function(){var self=this;var windowWidth=$(window).width();if(windowWidth<self.twoItemMaxWidth){self.defaultHitCount=2;}else if(windowWidth<self.fourItemMaxWidth){self.defaultHitCount=4;}else{self.defaultHitCount=6;};}},mounted:function(){var self=this;self.isbnArray=self.isbns.split(",");self.determineScrollWidth();self.getItems();self.setupGestures();}});});